
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mission Control — Shark Gun Learning Path</title>
  <style>
    :root{
      --bg:#0f1217;--panel:#161b22;--line:#222a36;--text:#e6e8ec;--muted:#a3adbd;
      --accent:#7dd3fc;--good:#34d399;--warn:#fbbf24;--danger:#fb7185
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 0% 0%, #0c1116, #0f1217);
         color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{display:flex;gap:12px;align-items:center}
    .card{border:1px solid var(--line);background:var(--panel);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
    h1,h2{margin:.2rem 0}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #2a3342;padding:8px 12px;border-radius:10px;background:#121820;color:var(--text);text-decoration:none;cursor:pointer}
    .btn:hover{border-color:#344055}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{border:1px solid #2a3342;border-radius:999px;padding:4px 10px;font-size:.9rem}
    .tools li{margin:.35rem 0}
    .tools code{user-select:all}
    .copy{cursor:pointer}
    /* Progress ring */
    .ring{--p:0; width:120px;height:120px;border-radius:50%;background:
      conic-gradient(var(--accent) calc(var(--p)*1%),#263041 0),radial-gradient(closest-side, #161b22 74%, transparent 76% 99%, #161b22 0);
      display:grid;place-items:center;font-weight:700}
    .ring small{color:var(--muted);font-weight:400}
    /* Quips */
    #quip{min-height:42px}
    /* XP bar + badge */
    .xp-wrap{display:flex;align-items:center;gap:12px}
    .xp-bar{position:relative;flex:1;height:12px;background:#0f1520;border:1px solid #263041;border-radius:999px;overflow:hidden}
    .xp-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#60a5fa,#34d399)}
    .xp-num{min-width:64px;text-align:right}
    .badge{width:40px;height:40px;border-radius:8px;border:1px solid #2a3342;background:#0f1520;display:grid;place-items:center;overflow:hidden}
    .badge img{width:100%;height:100%;image-rendering:pixelated}
    /* Wallpaper */
    .wall{position:relative;border-radius:12px;overflow:hidden;aspect-ratio:16/9;border:1px solid #273142}
    .wall img{width:100%;height:100%;object-fit:cover;filter:contrast(1.02) saturate(1.05)}
    .wall .overlay{position:absolute;inset:0;background:linear-gradient(0deg,rgba(15,18,23,.55),transparent 60%)}
    .wall .controls{position:absolute;left:12px;bottom:12px;display:flex;gap:8px}
    /* Checkboxes */
    .quest{display:flex;gap:10px;align-items:start;padding:8px 10px;border:1px dashed #2a3342;border-radius:10px;margin:8px 0}
    .quest input{transform:translateY(2px)}
    .side{margin-top:6px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>Mission Control</h1>
      <span class="pill muted">Shark Gun Learning Path</span>
    </div>
    <div class="row">
      <a class="btn" href="sidequest.html">Open Side Quest ↗</a>
      <a class="btn" href="import-quips.html">Import Quips (CSV→JSON)</a>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <div class="row" style="justify-content:space-between;">
        <div style="min-width:260px;">
          <h2>Today’s Progress</h2>
          <div id="quip" class="muted">Loading Bill’s quips…</div>
        </div>
        <div class="ring" id="ring"><div><span id="ringPct">0%</span><br><small>complete</small></div></div>
      </div>

      <div class="xp-wrap" style="margin-top:10px">
        <div class="badge" title="Sharkgun badge">
          <img src="public/sprites/pixel_sharkgun.png" alt="Sharkgun badge">
        </div>
        <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
        <div class="xp-num" id="xpNum">0 XP</div>
        <button class="btn" id="resetXp" title="Reset XP and checkboxes">Reset</button>
      </div>

      <h3>Java — Level 1</h3>
      <label class="quest"><input type="checkbox" data-quest-id="java-1"> Install Java 21 JDK (Temurin or Microsoft Build). </label>
      <label class="quest"><input type="checkbox" data-quest-id="java-2"> Install IntelliJ IDEA Community and run a simple “HelloWorld”. </label>
      <label class="quest"><input type="checkbox" data-quest-id="java-3"> Install Minecraft Forge MDK and build once. </label>

      <h3>Bedrock — Level 1</h3>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock-1"> Create a resource pack folder with <code>manifest.json</code>. </label>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock-2"> Add a <code>pack_icon.png</code> and show in game. </label>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock-3"> Create a simple item with a custom texture. </label>

      <h3 style="margin-top:14px">Java — Level 2 (Model → Texture → MDK Test)</h3>
      <label class="quest"><input type="checkbox" data-quest-id="java2-1"> Blockbench: create a low-poly shark cannon (<a href="https://www.youtube.com/results?search_query=blockbench+minecraft+model+tutorial" target="_blank" rel="noopener">modeling tutorial</a>). </label>
      <label class="quest"><input type="checkbox" data-quest-id="java2-2"> Texture it: export a PNG to <code>/public/sprites/</code> and preview in Mission Control. </label>
      <label class="quest"><input type="checkbox" data-quest-id="java2-3"> Export <code>.bbmodel</code> to <code>/public/models/</code> for versioning. </label>
      <label class="quest"><input type="checkbox" data-quest-id="java2-4"> Forge MDK: create a new item class (placeholder stats) and register it (resources + lang entry). </label>
      <label class="quest"><input type="checkbox" data-quest-id="java2-5"> Build & run client from IntelliJ: verify item appears in the creative tab. </label>

      <h3>Bedrock — Level 2 (Resource + Behavior Packs)</h3>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock2-1"> Add a new item texture (your shark cannon) to the resource pack; update <code>textures/item_texture.json</code>. </label>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock2-2"> Behavior pack: define a basic item with identifier, category, and display name. </label>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock2-3"> Test in Minecraft (Bedrock): confirm icon + name show (use <code>pack_icon.png</code> for both packs). </label>
      <label class="quest"><input type="checkbox" data-quest-id="bedrock2-4"> Optional: add a simple recipe JSON referencing the new item. </label>

      <div class="side">
        <a class="btn" href="sidequest.html">▶ Blockbench Side Quest</a>
      </div>
    </section>

    <aside class="card">
      <div class="wall">
        <img id="wallImg" src="public/wallpapers/wallpaper_geometry.JPG" alt="Wallpaper">
        <div class="overlay"></div>
        <div class="controls">
          <label class="btn"><input type="file" id="wallFile" accept="image/*" style="display:none">Set wallpaper…</label>
          <button class="btn" id="wallClear">Use default</button>
          <button class="btn" id="wallToggle">Toggle preview</button>
        </div>
      </div>

      <h3 style="margin-top:14px">Tools Launcher (paths)</h3>
      <p class="muted">Browsers block launching apps; use these with <em>Copy</em> and open via Start menu or File Explorer.</p>
      <ul class="tools">
        <li><strong>Project folder (Google Drive):</strong> <code>G:\My Drive\Mission-control</code> <button class="btn copy" data-copy="G:\My Drive\Mission-control">Copy</button></li>
        <li>IntelliJ (install dir): <code>C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2025.2.1</code> <button class="btn copy" data-copy="C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2025.2.1">Copy</button></li>
        <li>IntelliJ Shortcut: <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\JetBrains\IntelliJ IDEA Community Edition 2025.2.1.lnk</code> <button class="btn copy" data-copy="C:\ProgramData\Microsoft\Windows\Start Menu\Programs\JetBrains\IntelliJ IDEA Community Edition 2025.2.1.lnk">Copy</button></li>
        <li>Blockbench Shortcut: <code>C:\Users\Sam\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Blockbench.lnk</code> <button class="btn copy" data-copy="C:\Users\Sam\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Blockbench.lnk">Copy</button></li>
        <li>Notepad++: <code>C:\Program Files\Notepad++\notepad++.exe</code> <button class="btn copy" data-copy="C:\Program Files\Notepad++\notepad++.exe">Copy</button></li>
        <li>Minecraft (Java): <code>C:\Users\Sam\curseforge\minecraft\Install\minecraft.exe</code> <button class="btn copy" data-copy="C:\Users\Sam\curseforge\minecraft\Install\minecraft.exe">Copy</button></li>
        <li>CurseForge Shortcut: <code>C:\Users\Sam\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Overwolf\CurseForge.lnk</code> <button class="btn copy" data-copy="C:\Users\Sam\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Overwolf\CurseForge.lnk">Copy</button></li>
        <li>Mod project folder: <code>C:\users\sam\downloads\minecraft_sharkgun_mod</code> <button class="btn copy" data-copy="C:\users\sam\downloads\minecraft_sharkgun_mod">Copy</button></li>
      </ul>
    </aside>
  </div>

  <footer class="muted" style="margin:16px 4px">
    Tip: run via <code>python -m http.server 8000</code> so quips load from <code>/public/data/quips.json</code> or <code>Bill_Cipher_Dialogue_Expanded.csv</code>.
  </footer>
</div>

<script>
  // ====== State utils ======
  const store = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
  const load = (k, d=null)=>{try{return JSON.parse(localStorage.getItem(k)) ?? d}catch{ return d }};

  // ====== Quips loader (JSON -> CSV -> inline) ======
  const inlineQuips = [
    "Bill: Checkbox acquired. The dopamine economy approves.",
    "Bill: Keep it bite-sized; sharks prefer chunks.",
    "Bill: New sprite? Pixelicious.",
    "Bill: Ship what you have, not what perfect you imagined.",
  ];

  function parseCSV(csv){
    const rows=[]; let i=0, field='', row=[], inQ=false;
    while(i<csv.length){
      const ch = csv[i];
      if(ch === '"'){
        if(inQ && csv[i+1] === '"'){ field+='"'; i++; }
        else inQ = !inQ;
      }else if(ch === ',' && !inQ){
        row.push(field); field='';
      }else if((ch === '\n' || ch === '\r') && !inQ){
        if(field.length || row.length){ row.push(field); rows.push(row); row=[]; field=''; }
        if(ch === '\r' && csv[i+1] === '\n') i++;
      }else{
        field += ch;
      }
      i++;
    }
    if(field.length || row.length){ row.push(field); rows.push(row); }
    return rows;
  }

  function csvToQuips(text){
    const rows = parseCSV(text);
    if(!rows.length) return [];
    const header = rows[0].map(h=>h.trim().toLowerCase());
    let idx = header.indexOf('text');
    if(idx === -1) idx = header.indexOf('quip');
    if(idx === -1) idx = header.length === 1 ? 0 : header.length-1;
    const out = [];
    for(let r=1; r<rows.length; r++){
      const cell = (rows[r][idx] ?? '').trim();
      if(cell) out.push(cell);
    }
    return out;
  }

  async function loadQuips(){
    // 1) Try JSON
    try{
      const res = await fetch('public/data/quips.json', {cache:'no-store'});
      if(res.ok){
        const data = await res.json();
        const arr = (data && Array.isArray(data.quips)) ? data.quips.map(q=>q.text) : [];
        if(arr.length) return arr;
      }
    }catch(e){}
    // 2) Try CSV
    try{
      const r2 = await fetch('public/data/Bill_Cipher_Dialogue_Expanded.csv', {cache:'no-store'});
      if(r2.ok){
        const text = await r2.text();
        const arr = csvToQuips(text);
        if(arr.length) return arr;
      }
    }catch(e){}
    // 3) Fallback inline
    return inlineQuips;
  }

  // ====== Confetti (tiny, inline) ======
  function confettiBurst() {
    const c = document.createElement('canvas');
    c.style.position='fixed'; c.style.inset='0'; c.style.pointerEvents='none';
    document.body.appendChild(c);
    const ctx = c.getContext('2d'); const W = c.width = innerWidth; const H = c.height = innerHeight;
    const N = 150, P = Array.from({length:N},()=>({x:W/2,y:H/4+Math.random()*40, vx:(Math.random()-0.5)*6, vy:Math.random()*-8-4, r:2+Math.random()*3, a:1}));
    let t=0;
    const tick=()=>{
      ctx.clearRect(0,0,W,H);
      for(const p of P){
        p.vy+=0.25; p.x+=p.vx; p.y+=p.vy; p.a-=0.008;
        ctx.globalAlpha = Math.max(p.a,0);
        ctx.fillStyle = `hsl(${(t*2+p.x)%360}, 90%, 60%)`;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      }
      t++;
      if(t<320) requestAnimationFrame(tick); else document.body.removeChild(c);
    };
    tick();
  }

  // ====== XP + progress ring ======
  const XP_PER_CHECK = 10;
  function updateRing() {
    const ids = Array.from(document.querySelectorAll('[data-quest-id]'));
    const done = ids.filter(el=>el.checked).length;
    const pct = Math.round(done / Math.max(ids.length,1) * 100);
    document.getElementById('ring').style.setProperty('--p', pct);
    document.getElementById('ringPct').textContent = pct + '%';
  }
  function setXp(xp){
    const cap = 500; // simple cap for L1/2
    const pct = Math.min(100, Math.round(xp/cap*100));
    document.getElementById('xpFill').style.width = pct + '%';
    document.getElementById('xpNum').textContent = xp + ' XP';
    store('xp', xp);
  }

  // ====== Milestones (+bonus XP) & Level-Up animation ======
  const MILESTONES = [
    { id:'java2_all',    required:['java2-1','java2-2','java2-3','java2-4','java2-5'], bonus:50, label:'Java — Level 2 Complete! +50 XP' },
    { id:'bedrock2_all', required:['bedrock2-1','bedrock2-2','bedrock2-3','bedrock2-4'],       bonus:50, label:'Bedrock — Level 2 Complete! +50 XP' },
  ];

  function levelUpAnim(text){
    const wrap = document.createElement('div');
    wrap.style.position='fixed'; wrap.style.inset='0'; wrap.style.display='grid'; wrap.style.placeItems='center';
    wrap.style.background='rgba(0,0,0,0.55)'; wrap.style.zIndex='9999'; wrap.style.backdropFilter='blur(2px)';
    const card = document.createElement('div');
    card.style.background='#161b22'; card.style.border='1px solid #2a3342'; card.style.borderRadius='16px';
    card.style.padding='18px 20px'; card.style.boxShadow='0 14px 36px rgba(0,0,0,.45)'; card.style.display='grid'; card.style.justifyItems='center'; card.style.gap='10px';
    const img = document.createElement('img'); img.src='public/sprites/pixel_sharkgun.png'; img.alt='Badge'; img.style.width='72px'; img.style.height='72px'; img.style.imageRendering='pixelated';
    const h = document.createElement('div'); h.textContent = text; h.style.fontWeight='700';
    const sub = document.createElement('div'); sub.textContent = 'Nice work!'; sub.style.color='#a3adbd';
    card.appendChild(img); card.appendChild(h); card.appendChild(sub); wrap.appendChild(card); document.body.appendChild(wrap);
    card.animate([{transform:'scale(.9)',opacity:.0},{transform:'scale(1)',opacity:1}],{duration:220,easing:'ease-out'});
    setTimeout(()=>{
      wrap.animate([{opacity:1},{opacity:0}],{duration:420}); setTimeout(()=>wrap.remove(), 450);
    }, 1400);
    try{ confettiBurst(); }catch{}
  }

  function hasAll(ids, checkedSet){ return ids.every(id => checkedSet.has(id)); }
  function checkMilestones(checkedSet){
    let xp = load('xp',0);
    let awarded = load('awardedMilestones', {});
    let changed = false;
    for(const m of MILESTONES){
      if(!awarded[m.id] && hasAll(m.required, checkedSet)){
        xp += m.bonus; awarded[m.id] = true; changed = true;
        setXp(xp);
        levelUpAnim(m.label);
      }
    }
    if(changed) store('awardedMilestones', awarded);
  }

  // ====== Wallpaper ======
  const wallImg = document.getElementById('wallImg');
  function setWallpaper(src, persist=true){
    wallImg.src = src;
    if(persist) store('wallSrc', src);
  }

  // ====== Copy buttons ======
  for(const b of document.querySelectorAll('.copy')){
    b.addEventListener('click', async (e)=>{
      const v = b.dataset.copy;
      try{ await navigator.clipboard.writeText(v); b.textContent='Copied!'; setTimeout(()=>b.textContent='Copy',1200);}catch{}
    });
  }

  (async function init(){
    // Load quips and rotate
    const quips = await loadQuips();
    const qEl = document.getElementById('quip');
    const rot = ()=>{ qEl.textContent = quips[Math.floor(Math.random()*quips.length)] };
    rot(); setInterval(rot, 7000);

    // Restore checkboxes
    const checked = new Set(load('checked', []));
    document.querySelectorAll('[data-quest-id]').forEach(cb=>{
      cb.checked = checked.has(cb.dataset.questId);
      cb.addEventListener('change', ()=>{
        const id = cb.dataset.questId;
        if(cb.checked){ checked.add(id); setXp((load('xp',0))+10); confettiBurst(); rot(); }
        else { checked.delete(id); setXp(Math.max(0, (load('xp',0)) - 10)); }
        store('checked', Array.from(checked)); updateRing(); checkMilestones(checked);
      });
    });

    // Init ring + XP
    updateRing(); setXp(load('xp',0)); checkMilestones(checked);

    // Wallpaper
    const saved = load('wallSrc', null);
    if(saved) setWallpaper(saved, false);
    document.getElementById('wallFile').addEventListener('change', (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = ev => setWallpaper(ev.target.result);
      reader.readAsDataURL(f);
    });
    document.getElementById('wallClear').addEventListener('click', ()=>{
      setWallpaper('public/wallpapers/wallpaper_geometry.JPG'); 
    });
    document.getElementById('wallToggle').addEventListener('click', ()=>{
      const img = document.getElementById('wallImg');
      img.style.display = (img.style.display==='none')?'block':'none';
    });

    // Reset
    document.getElementById('resetXp').addEventListener('click', ()=>{
      localStorage.removeItem('xp'); localStorage.removeItem('checked'); localStorage.removeItem('awardedMilestones');
      setXp(0);
      document.querySelectorAll('[data-quest-id]').forEach(cb=>cb.checked=false);
      updateRing();
    });
  })();
</script>
</body>
</html>
